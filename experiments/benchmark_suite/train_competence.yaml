# @package _global_
name: "competence_curriculum"

logger:
  wandb:
    enabled: true
    project: "causal_meta"
    tags: ["competence", "train"]

data:
  # -------------------------------------------------------------------------
  # TRAINING FAMILY: The "Competence" Mixture
  # -------------------------------------------------------------------------
  train_family:
    name: competence_train
    n_nodes: 20
    
    # Graph: Mixture of ER (Sparse) and SF (Hubs)
    graph_cfg:
      type: mixture
      weights: [0.5, 0.5]
      generators:
        - type: er
          sparsity: 0.2  # Expected deg ~ 4
        - type: sf
          m: 2           # Preferential attachment
    
    # Mechanisms: Mixture of Linear, MLP, GP
    mech_cfg:
      type: mixture
      weights: [0.34, 0.33, 0.33]
      factories:
        - type: linear
          weight_scale: 1.0
          noise_concentration: 2.0  # Heteroscedasticity
        - type: mlp
          hidden_dim: 32
        - type: gp
          rff_dim: 256
          length_scale_range: [0.5, 2.0]

  # -------------------------------------------------------------------------
  # VALIDATION (In-Distribution)
  # -------------------------------------------------------------------------
  val_families:
    id_val:
      name: id_val
      n_nodes: 20
      graph_cfg:
        type: er
        sparsity: 0.2
      mech_cfg:
        type: linear

  # -------------------------------------------------------------------------
  # TEST FAMILIES (Placeholder - overridden by audit configs usually)
  # -------------------------------------------------------------------------
  test_families:
    id_test:
      name: id_test
      n_nodes: 20
      graph_cfg:
        type: er
        sparsity: 0.2
      mech_cfg:
        type: linear

  seeds_val: [1000, 1001, 1002, 1003, 1004]
  seeds_test: [2000, 2001, 2002, 2003, 2004]
  base_seed: 42
  samples_per_task: 256
  safety_checks: true
  num_workers: 4
  pin_memory: true

model:
  type: "avici"
  num_nodes: 20
  d_model: 128
  nhead: 8
  num_layers: 6
  dim_feedforward: 512
  dropout: 0.1

objective:
  name: "bce"
  pos_weight: 1.0

trainer:
  lr: 0.0001
  max_steps: 100000
  log_every_n_steps: 100
  val_check_interval: 1000
  check_val_every_n_epoch: null

inference:
  n_samples: 50

hydra:
  run:
    dir: ${oc.env:CAUSAL_META_RUN_DIR,experiments/${name}/${now:%Y-%m-%d}/${now:%H-%M-%S}}
  sweep:
    dir: ${oc.env:CAUSAL_META_SWEEP_DIR,experiments/${name}/multirun/${now:%Y-%m-%d}/${now:%H-%M-%S}}
    subdir: ${hydra.job.num}
