# @package hydra.launcher
_target_: hydra_plugins.hydra_submitit_launcher.submitit_launcher.SlurmLauncher
submitit_folder: ${hydra.sweep.dir}/.submitit

# Job Resources (Per Model/Task)
timeout_min: 1440 # 24 hours
max_num_timeout: 3 # Auto-requeue timed-out jobs (up to 4 total attempts)
cpus_per_task: 5 # CPUs per GPU task
tasks_per_node: 1
mem_gb: 50
nodes: 1

# Scheduler Directives
partition: "GPU-a100"
name: "cm_${model.id}"
# account: <YOUR_ACCOUNT>   # Uncomment if required

# specific SBATCH flags
additional_parameters:
  gres: "gpu:a100:1"
  requeue: true
  mail-user: ${oc.env:SLURM_MAIL_USER,e12229950@student.tuwien.ac.at}
  mail-type: "BEGIN,END,FAIL"

setup:
  # Undo login-node env vars that block GPU access (set by deploy.sh)
  - unset CUDA_VISIBLE_DEVICES
  - unset JAX_PLATFORMS
  - export OMP_NUM_THREADS=${hydra.launcher.cpus_per_task}
  - export HYDRA_FULL_ERROR=1
