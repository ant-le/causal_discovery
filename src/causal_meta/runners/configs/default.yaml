# @package _global_
defaults:
  - _self_
  # - hydra/launcher: submitit_local

# Minimal default config for installed usage (`python -m causal_meta.runners.pipe`).
name: "smoke_test"

logger:
  wandb:
    enabled: false

data:
  train_family:
    name: train
    n_nodes: 10
    graph_cfg:
      type: er
      sparsity: 0.2
    mech_cfg:
      type: linear
      weight_scale: 1.0

  val_families:
    id_val:
      name: id_val
      n_nodes: 10
      graph_cfg:
        type: er
        sparsity: 0.2
      mech_cfg:
        type: linear
        weight_scale: 1.0

  test_families:
    test_1:
      name: test_1
      n_nodes: 10
      graph_cfg:
        type: er
        sparsity: 0.2
      mech_cfg:
        type: linear
        weight_scale: 1.0

  seeds_val: [100, 101]
  seeds_test: [200, 201]
  base_seed: 42
  samples_per_task: 32
  safety_checks: true
  num_workers: 0
  pin_memory: false

model:
  type: "avici"
  num_nodes: 10
  d_model: 16
  nhead: 2
  num_layers: 2
  dim_feedforward: 32
  dropout: 0.1

trainer:
  max_steps: 10
  log_every_n_steps: 2
  val_check_interval: 5
  lr: 0.001
  weight_decay: 1e-4
  grad_clip_norm: 1.0
  scheduler: cosine
  scheduler_t_max: 10
  scheduler_eta_min: 0.0

inference:
  n_samples: 5
  inil_graph_samples: 5
  use_cached_inference: true
  cache_inference: true

hydra:
  run:
    dir: ${oc.env:CAUSAL_META_RUN_DIR,experiments/${name}/${now:%Y-%m-%d}/${now:%H-%M-%S}}
  sweep:
    dir: ${oc.env:CAUSAL_META_SWEEP_DIR,experiments/${name}/multirun/${now:%Y-%m-%d}/${now:%H-%M-%S}}
    subdir: ${hydra.job.num}
